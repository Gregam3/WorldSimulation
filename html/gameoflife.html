<html>
<head>
    <title>World Simulator</title>
    <script src="jssim.js" type="text/javascript"></script>
</head>
<body>
<h2>World Simulator <input type="text" id="simTime" value=""/></h2>
<canvas id="myCanvas" width="200" height="200" style="border:1px solid #000000;">
</canvas>


<script>
    (function () {
        var CellularAgent = function (world) {
            jssim.SimEvent.call(this);
            this.world = world;
        };

        CellularAgent.prototype = Object.create(jssim.SimEvent.prototype);

        function updateWorld(width, height) {
            for (let x = 0; x < width; ++x) {
                let randomFactor = 0.9;
                for (let j = 0; j < height; ++j) {
                    randomFactor -= 0.1;
                    if (Math.random() < randomFactor) {
                        this.world.setCell(x, j, '#AAAAAA'); // dead
                    } else {
                        this.world.setCell(x, j, '#8a3333'); // live
                    }
                    sleep(1000);
                    console.log(this.world);
                }
            }
        }

        CellularAgent.prototype.update = function () {
            const width = this.world.width;
            const height = this.world.height;
            updateWorld.call(this, width, height);
        };

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        const scheduler = new jssim.Scheduler();
        const grid = new jssim.Grid(128, 128);

        function init() {
            scheduler.reset();
            grid.reset();
            grid.cellWidth = 50;
            grid.cellHeight = 50;
            grid.showTrails = false;
            grid.trailColor = '#222222';
            scheduler.scheduleRepeatingIn(new CellularAgent(grid), 1);
        }

        init();
        var canvas = document.getElementById("myCanvas");
        setInterval(function () {
            scheduler.update();

            grid.render(canvas);
            console.log('current simulation time: ' + scheduler.current_time);
            document.getElementById("simTime").value = "Generation: " + scheduler.current_time;
        }, 50);
    })();
</script>
</body>
</html>