<html>
<head>
    <title>World Simulator</title>
    <script src="jssim.js" type="text/javascript"></script>
</head>
<body>
<h2>World Simulator <input type="text" id="simTime" value=""/></h2>
<canvas id="myCanvas" width="200" height="200" style="border:1px solid #000000;">
</canvas>


<script>
    (function () {
        var CellularAgent = function (world) {
            jssim.SimEvent.call(this);
            this.world = world;
        };

        CellularAgent.prototype = Object.create(jssim.SimEvent.prototype);
        CellularAgent.prototype.update = function () {
            const width = this.world.width;
            const height = this.world.height;
            for (let i = 0; i < width; ++i) {
                for (let j = 0; j < height; ++j) {
                    if (Math.random() < 0.5) {
                        this.world.setCell(i, j, '#FF22DD'); // dead
                    } else {
                        this.world.setCell(i, j, 2); // live
                    }
                }
            }
        };

        const scheduler = new jssim.Scheduler();
        const grid = new jssim.Grid(128, 128);

        function init() {
            scheduler.reset();
            grid.reset();
            grid.cellWidth = 5;
            grid.cellHeight = 5;
            grid.showTrails = false;
            grid.trailColor = '#222222';
            scheduler.scheduleRepeatingIn(new CellularAgent(grid), 1);
        }

        init();
        var canvas = document.getElementById("myCanvas");
        setInterval(function () {
            scheduler.update();

            grid.render(canvas);
            console.log('current simulation time: ' + scheduler.current_time);
            document.getElementById("simTime").value = "Generation: " + scheduler.current_time;
        }, 50);
    })();
</script>
</body>
</html>